:root { color-scheme: light dark; --brand:#0d6efd; --bg:#0b1020; --text:#111; --soft:#f4f6fa; --border:#e2e8f0; }
* { box-sizing: border-box; }
html, body { 
  height: 100%; 
  width: 100%;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
}
body { 
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; 
  margin: 0; 
  padding: 0;
  padding-top: env(safe-area-inset-top);
  background: #fff; 
  color: var(--text); 
  overflow-x: hidden;
  position: relative;
}
.container { max-width: 1000px; margin-inline: auto; padding: 1rem; width: 100%; }
.header { background: var(--brand); color: #fff; display:flex; align-items:center; justify-content:space-between; border-bottom: 1px solid color-mix(in srgb, var(--brand) 60%, #0000); border-radius: 0 0 .6rem .6rem; min-height: 60px; }
.brand { display: flex; align-items: center; flex-shrink: 0; }
.brand-link { color:#fff; text-decoration:none; font-weight:700; font-size:1.25rem; }
.nav { display:flex; gap:.5rem; align-items:center; flex-wrap: wrap; }
.nav-link { color:#fff; text-decoration:none; opacity:.9; padding:.5rem .6rem; border-radius:.4rem; }
.nav-link:hover { opacity:1; background: color-mix(in srgb, #ffffff 10%, var(--brand)); }
.btn { background:#fff; color:var(--brand); border:1px solid #ffffff80; padding:.45rem .8rem; border-radius:.5rem; text-decoration:none; display:inline-flex; align-items:center; gap:.4rem; white-space: nowrap; }
.btn:hover { background:#f8fafc; }
.btn.danger { color:#fff; background:#dc2626; border-color:#dc2626; }
.btn.danger:hover { background:#b91c1c; }
.main { padding: 1rem; }
.muted { opacity:.8; font-size:.9rem; }
footer { padding-bottom: env(safe-area-inset-bottom, 0px); }
section { background: #fff; padding: 1rem; border-radius: .75rem; border:1px solid var(--border); box-shadow: 0 6px 20px rgba(2,6,23,.06); }
.row { display:flex; gap:.6rem; }
input, button { font: inherit; }
input[type="text"], input[type="tel"], input[name="name"], input[name="phone"], input[name="content"], input[name="author_name"], input[name="code"], textarea, select {
  padding:.6rem .8rem; border:1px solid var(--border); border-radius:.5rem; background:#fff; color:inherit; outline:none; width: 100%;
}
button, .btn[role="button"] { cursor:pointer; }
ul { margin:0; padding-inline-start:1rem; }
.messages { list-style:none; padding:0; margin:0 0 1rem 0; display:flex; flex-direction:column; gap:.4rem; }
.message { background:#fef3c7; color:#92400e; border:1px solid #fde68a; padding:.5rem .75rem; border-radius:.5rem; }
.card-list { list-style:none; padding:0; display:flex; flex-direction:column; gap:.6rem; }
.card { display:flex; justify-content:space-between; align-items:center; padding:.8rem 1rem; border:1px solid var(--border); border-radius:.6rem; background:var(--soft); }
.card a { text-decoration:none; color:#0b5ed7; }
.chat-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:.5rem; }
.bubble { background:#f1f5f9; padding:.6rem .75rem; border-radius:.75rem; max-width: 90%; align-self:flex-start; }
.bubble.me { background:#dbeafe; align-self:flex-end; }
.chat-form { display:flex; gap:.5rem; align-items:center; margin-top:1rem; }

/* WhatsApp-like theme overrides */
:root { --brand:#25D366; --brand-dark:#128C7E; --bubble-in:#E7FFD9; --bubble-out:#DCF8C6; --chip:#e2f7eb; }

.header { background: linear-gradient(180deg, var(--brand) 0%, color-mix(in srgb, var(--brand) 80%, #0000) 100%); }
.btn { color: var(--brand); }

/* Chat area background and layout */
.whatsapp-layout { display:grid; grid-template-columns: 320px 1fr; gap:1rem; }
@media (max-width: 900px) {
  .whatsapp-layout { grid-template-columns: 1fr; }
}
.chat-area { background:
  radial-gradient(ellipse at top right, #f5fff7 0%, #ffffff 70%);
}

/* Conversation list (sidebar) */
.chat-sidebar .chat-item { display:flex; align-items:center; gap:.75rem; padding:.75rem 1rem; border-bottom:1px solid var(--border); }
.chat-sidebar .avatar { width:40px; height:40px; border-radius:50%; background: var(--chip); flex:none; }
.chat-sidebar .title { font-weight:600; }
.chat-sidebar .meta { font-size:.8rem; opacity:.8; }
.unread-badge { display:inline-block; min-width:18px; height:18px; padding:0 .4rem; border-radius:999px; background: var(--brand); color:#fff; font-size:.75rem; line-height:18px; text-align:center; margin-inline-start:.5rem; }

/* Bubbles like WhatsApp */
.chat-list { padding: .25rem; }
.bubble { position:relative; background: var(--bubble-in); border:1px solid color-mix(in srgb, var(--bubble-in) 80%, #000); }
.bubble.me { background: var(--bubble-out); border-color: color-mix(in srgb, var(--bubble-out) 80%, #000); }
.bubble strong { font-weight:600; }
.bubble .meta { display:block; font-size:.7rem; opacity:.7; margin-top:.25rem; text-align:end; }

/* Input bar */
.chat-form { background:#fff; border:1px solid var(--border); border-radius:.75rem; padding:.5rem; }
.chat-form input[name="content"] { background:#fff; }

/* Mobile Responsive Styles */
@media (max-width: 768px) {
  html, body {
    max-width: 100vw;
    overflow-x: hidden !important;
  }
  
  body {
    padding-top: env(safe-area-inset-top, 0px) !important;
  }
  
  .container {
    max-width: 100% !important;
    width: 100% !important;
    padding: 0.5rem !important;
    margin: 0 !important;
  }
  
  .header { 
    flex-direction: row;
    flex-wrap: wrap;
    padding: 0.75rem 0.75rem 0.5rem 0.75rem;
    padding-top: calc(0.75rem + env(safe-area-inset-top, 0px));
    gap: 0.5rem;
    min-height: auto;
    width: 100%;
    margin: 0;
    border-radius: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  
  .brand {
    flex: 0 0 auto;
    min-width: 0;
  }
  
  .brand-link {
    font-size: 1rem;
  }
  
  .nav { 
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
    font-size: 0.85rem;
    justify-content: flex-start;
    align-items: center;
    width: 100%;
  }
  
  .nav-link {
    padding: 0.35rem 0.5rem;
    font-size: 0.85rem;
    line-height: 1.2;
  }
  
  .btn {
    font-size: 0.8rem;
    padding: 0.35rem 0.6rem;
    white-space: normal;
    text-align: center;
    line-height: 1.2;
  }
  
  .btn.danger {
    font-size: 0.75rem;
    padding: 0.3rem 0.5rem;
  }
  
  .main {
    padding: 0.75rem 0.5rem;
    width: 100%;
    max-width: 100%;
    padding-top: calc(0.75rem + env(safe-area-inset-top, 0px));
  }
  
  section {
    padding: 0.75rem;
    margin: 0.5rem 0;
    width: 100%;
    box-sizing: border-box;
  }
  
  .whatsapp-layout {
    grid-template-columns: 1fr !important;
    display: flex !important;
    flex-direction: column;
  }
  
  .chat-form {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .chat-form input[name="author_name"] {
    max-width: 100% !important;
    width: 100%;
    order: 1;
  }
  
  .chat-form input[name="content"] {
    width: 100%;
    flex: none;
    order: 2;
  }
  
  .chat-form button {
    width: 100%;
    justify-content: center;
    order: 3;
  }
  
  .card {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.75rem;
    width: 100%;
    box-sizing: border-box;
  }
  
  .row {
    flex-direction: column;
    gap: 0.5rem;
    width: 100%;
  }
  
  .row input,
  .row button {
    width: 100%;
    max-width: 100%;
  }
  
  /* Force all elements to respect viewport width */
  * {
    max-width: 100%;
    box-sizing: border-box;
  }
  
  /* Mobile chat layout */
  .chat-sidebar {
    order: 2;
    max-height: 250px;
    overflow-y: auto;
    margin-top: 0.5rem;
  }
  
  .chat-area {
    order: 1;
  }
  
  .bubble {
    word-wrap: break-word;
    word-break: break-word;
    max-width: 85%;
  }
  
  input, textarea {
    font-size: 16px !important; /* Prevent zoom on iOS */
  }
  
  h2 {
    font-size: 1.3rem;
    margin-top: 0;
  }
  
  /* Messages */
  .messages {
    gap: 0.5rem;
  }
  
  .message {
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
  }
}

/* Extra small screens */
@media (max-width: 480px) {
  .nav {
    font-size: 0.8rem;
  }
  
  .nav-link {
    padding: 0.3rem 0.4rem;
  }
  
  .btn {
    font-size: 0.8rem;
    padding: 0.35rem 0.6rem;
  }
  
  h2 {
    font-size: 1.2rem;
  }
  
  .bubble {
    max-width: 95% !important;
    font-size: 0.9rem;
    padding: 0.5rem 0.65rem;
  }
}

/* Additional Improvements */

/* Chat list scrolling */
.chat-list {
  max-height: calc(100vh - 280px);
  overflow-y: auto;
  scroll-behavior: smooth;
  padding-bottom: 1rem;
}

@media (max-width: 768px) {
  .chat-list {
    max-height: calc(100vh - 320px);
  }
}

/* Better focus states for accessibility */
input:focus, 
button:focus, 
.btn:focus,
a:focus {
  outline: 2px solid var(--brand);
  outline-offset: 2px;
}

/* Loading state */
.loading {
  opacity: 0.6;
  pointer-events: none;
  cursor: wait;
}

/* Hide empty unread badges */
.unread-badge:empty {
  display: none;
}

/* Smooth scroll for entire page */
html {
  scroll-behavior: smooth;
}

/* Better text selection */
::selection {
  background: color-mix(in srgb, var(--brand) 30%, transparent);
  color: inherit;
}

/* Improve tap highlight on mobile */
* {
  -webkit-tap-highlight-color: color-mix(in srgb, var(--brand) 20%, transparent);
}

/* Chat sidebar scrolling */
.chat-sidebar {
  display: flex;
  flex-direction: column;
  max-height: 85vh;
}

.chat-sidebar .card-list {
  overflow-y: auto;
  flex: 1;
}

/* Animation for new messages */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.bubble.new {
  animation: slideIn 0.3s ease-out;
}

/* Better word break for Arabic and English */
.bubble {
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

/* Status indicator for WebSocket connection */
.connection-status {
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  padding: 0.5rem 1rem;
  border-radius: 999px;
  background: var(--brand);
  color: white;
  font-size: 0.85rem;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  display: none;
}

.connection-status.disconnected {
  background: #dc2626;
  display: block;
}

/* Typing indicator */
.typing-indicator {
  display: inline-flex;
  gap: 4px;
  padding: 0.5rem 0.75rem;
}

.typing-indicator span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #94a3b8;
  animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.7;
  }
  30% {
    transform: translateY(-8px);
    opacity: 1;
  }
}
